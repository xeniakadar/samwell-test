import Head from "next/head";
import {
  Container,
  Main,
  Title,
  Description,
  CodeTag,
  Summary,
  UserList,
} from "../components/sharedstyles";
import Link from "next/link";
import Cards from "../components/cards";

export async function getServerSideProps() {
  const signupsRes = await fetch("http://localhost:3000/api/signups");
  const signups = await signupsRes.json();

  const loginsRes = await fetch("http://localhost:3000/api/logins");
  const logins = await loginsRes.json();

  const upgradesRes = await fetch("http://localhost:3000/api/upgrades");
  const upgrades = await upgradesRes.json();

  return { props: { signups, logins, upgrades } };
}

export default function Home({ signups, logins, upgrades }) {
  return (
    <Container>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Main>
        <Title>
          Welcome to <a href="https://nextjs.org">Next.js!</a>
        </Title>

        <Description>
          Get started by editing
          <CodeTag>pages/index.tsx</CodeTag>
        </Description>

        <Summary>
          <p>New Signups: {signups.length}</p>
          <p>Logins: {logins.length}</p>
          <p>Upgrades: {upgrades.length}</p>
        </Summary>
        <UserList>
          {signups.map((user) => (
            <li key={user.id}>
              <Link href={`/users/${user.id}`}>{user.name}</Link> -{" "}
              {user.signupDate}
            </li>
          ))}
        </UserList>

        <Cards />
      </Main>
    </Container>
  );
}
